# HostPro - Architecture & Documentation

> Document de référence pour le partage inter-projets Replit

---

## Résumé

**Nom**: HostPro  
**Type**: Plateforme SaaS communautaire pour hôtes STR (location courte durée)  
**Marques**: Quebexico (Québec), Hodos (International)  
**Langues**: Français / English  
**URL Dev**: quebexico.com / hodos.icu

---

## Stack Technique

### Frontend
| Technologie | Usage |
|-------------|-------|
| React 18 | Framework UI |
| TypeScript | Typage |
| Vite | Build tool |
| Wouter | Routing |
| TanStack Query | State management / API |
| Tailwind CSS v4 | Styling |
| shadcn/ui (Radix) | Composants UI |
| Recharts | Graphiques |
| Framer Motion | Animations |

### Backend
| Technologie | Usage |
|-------------|-------|
| Node.js + Express | Serveur API |
| TypeScript (ESM) | Typage |
| Drizzle ORM | Base de données |
| PostgreSQL | Database |
| Passport | Authentification |
| express-session | Sessions (PostgreSQL store) |

### Services externes
| Service | Usage |
|---------|-------|
| Stripe | Paiements / Abonnements |
| Resend | Emails transactionnels |
| OpenAI | IA Co-hôte / Concierge |
| Google OAuth | Authentification |
| Google Drive | Base connaissances IA |
| Google Places | Import annuaire |

---

## Structure des dossiers

```
├── client/                 # Frontend React
│   ├── src/
│   │   ├── components/     # Composants réutilisables
│   │   ├── pages/          # Pages de l'application
│   │   ├── hooks/          # Custom hooks
│   │   ├── lib/            # Utilitaires
│   │   └── App.tsx         # Routes principales
│   └── index.html
├── server/                 # Backend Express
│   ├── routes.ts           # Endpoints API
│   ├── storage.ts          # Interface base de données
│   ├── emailService.ts     # Templates emails
│   ├── icalService.ts      # Sync calendrier iCal
│   └── index.ts            # Point d'entrée serveur
├── shared/                 # Code partagé
│   └── schema.ts           # Schéma Drizzle (tables DB)
└── ARCHITECTURE.md         # Ce fichier
```

---

## Pages de l'application

### Pages publiques

| URL | Description |
|-----|-------------|
| `/` | Landing page principale (Quebexico) |
| `/hodos` | Landing page Hodos (international) |
| `/login` | Connexion |
| `/register` | Inscription |
| `/forgot-password` | Mot de passe oublié |
| `/reset-password` | Réinitialisation mot de passe |
| `/privacy` | Politique de confidentialité |
| `/terms` | Conditions d'utilisation |
| `/contact` | Page contact |

### Pages publiques - Contenu

| URL | Description |
|-----|-------------|
| `/g/:token` | Guide invité partageable (QR code) |
| `/l/:token` | Guide local public |
| `/directory` | Hub annuaire principal |
| `/directory/services` | Annuaire services |
| `/directory/str` | Annuaire fournisseurs STR |
| `/directory/str/:slug` | Fiche fournisseur détaillée |
| `/events` | Événements publics |
| `/blog` | Blog public |
| `/claim/:token` | Réclamer profil fournisseur |

### Pages publiques - Communautés

| URL | Description |
|-----|-------------|
| `/communities` | Liste des communautés |
| `/communities/str` | Landing communauté STR |
| `/communities/str/join` | Rejoindre communauté STR |
| `/community` | Page communauté membre |

### Pages publiques - Tunnels de vente

| URL | Description |
|-----|-------------|
| `/pro` | Hub professionnel |
| `/pro/hosts` | Landing hôtes STR |
| `/pro/cleaning` | Landing services ménagers |
| `/pro/investors` | Landing investisseurs |
| `/pro/partners` | Landing partenaires B2B |
| `/pro/providers` | Landing fournisseurs |
| `/join` | Redirection inscription |

### Pages hôte (authentifié)

| URL | Description |
|-----|-------------|
| `/host/dashboard` | Tableau de bord hôte |
| `/host/properties` | Gestion propriétés |
| `/host/calendar` | Calendrier réservations |
| `/host/bookings` | Liste réservations |
| `/host/messages` | Messagerie |
| `/host/finances` | Finances et revenus |
| `/host/reviews` | Avis clients |
| `/host/guide` | Guide hôte (welcome guide) |
| `/host/ai-cohost` | Assistant IA co-hôte |
| `/host/toolbox` | Boîte à outils / ressources |
| `/host/direct-sites` | Sites de réservation directe |
| `/host/website` | Constructeur de site (legacy) |
| `/mes-guides-locaux` | Gestionnaire guides locaux |
| `/settings` | Paramètres compte |
| `/hosts/pricing` | Tarification abonnements |
| `/onboarding` | Tunnel d'onboarding |
| `/beta` | Demande accès beta |

### Pages fournisseur (authentifié - provider)

| URL | Description |
|-----|-------------|
| `/provider/profile` | Profil entreprise fournisseur |
| `/provider/services` | Gestion des services offerts |
| `/provider/requests` | Demandes clients reçues |
| `/provider/reviews` | Avis reçus |
| `/provider/zones` | Zones de service |

### Pages admin (authentifié + isAdmin)

| URL | Description |
|-----|-------------|
| `/admin/pages` | Architecture des pages |
| `/admin/menus` | Gestion menus dynamiques |
| `/admin/ai` | Configuration IA |
| `/admin/categories` | Catégories annuaire |
| `/admin/leads` | Gestion leads/prospects |
| `/admin/suggestions` | Suggestions utilisateurs |
| `/admin/strategy` | Notes stratégiques |
| `/admin/stripe` | Administration Stripe |
| `/admin/emails` | Test/gestion emails |
| `/admin/content` | Hub de contenu (blog, events) |
| `/admin/prospect-flows` | Tunnels de prospection |
| `/admin/dev` | Changelog développement |
| `/admin/google-places` | Import Google Places |
| `/knowledge` | Base de connaissances IA |
| `/roadmap` | Feuille de route produit |

### Redirections legacy (à éviter)

| URL legacy | Redirige vers |
|------------|---------------|
| `/dashboard` | `/host/dashboard` |
| `/app` | `/host/dashboard` |
| `/properties` | `/host/properties` |
| `/calendar` | `/host/calendar` |
| `/bookings` | `/host/bookings` |
| `/messages` | `/host/messages` |
| `/finances` | `/host/finances` |
| `/website` | `/host/website` |
| `/reviews` | `/host/reviews` |
| `/host-guide` | `/host/guide` |
| `/ai-cohost` | `/host/ai-cohost` |
| `/toolbox` | `/host/toolbox` |
| `/pricing` | `/hosts/pricing` |
| `/annuaire` | `/directory/str` |
| `/cleaning` | `/pro/cleaning` |
| `/investors` | `/pro/investors` |
| `/partners` | `/pro/partners` |

---

## APIs Externes (pour autres projets)

### Authentification
Toutes les APIs externes utilisent le header `X-Api-Key` avec la clé du site.

### Endpoints disponibles

| Endpoint | Méthode | Description |
|----------|---------|-------------|
| `/api/external/direct-sites/config` | GET | Configuration du site (branding, couleurs, features) |
| `/api/external/direct-sites/properties` | GET | Liste des propriétés liées au site |
| `/api/external/direct-sites/availability?propertyId=X` | GET | Dates bloquées (événements calendrier) |
| `/api/external/direct-sites/reservations` | POST | Créer une nouvelle réservation |

### Endpoints publics (sans auth)

| Endpoint | Méthode | Description |
|----------|---------|-------------|
| `/api/public/guide/:token` | GET | Données guide public partageable |
| `/api/ical/:token` | GET | Export iCal d'une propriété |

### Exemple d'utilisation

```javascript
// Récupérer la config du site
const response = await fetch('https://hostpro.replit.app/api/external/direct-sites/config', {
  headers: {
    'X-Api-Key': 'votre-cle-api'
  }
});
const config = await response.json();
// { name, tagline, primaryColor, properties[], ... }
```

---

## Tables principales (schéma simplifié)

### Utilisateurs & Auth
```
users                    # Profils utilisateurs (id, email, name, profileImageUrl)
sessions                 # Sessions Express (sid, sess, expire)
user_settings            # Paramètres (plan, brand, isAdmin, language, stripeCustomerId)
```

### Propriétés & Calendrier
```
properties               # Propriétés STR (name, address, icalToken, userId)
property_ical_sources    # Sources iCal externes (url, platform, lastSyncAt)
calendar_events          # Événements calendrier (startDate, endDate, source, status)
```

### Guides
```
host_guides              # Guides d'accueil (propertyName, wifiName, checkInTime, ...)
local_recommendations    # Recommandations locales personnalisées
```

### Site de réservation directe
```
direct_sites             # Sites créés (name, apiKey, branding, features)
direct_site_property_links   # Liaison site ↔ propriétés
direct_site_reservations     # Réservations reçues (guest info, dates, status)
```

### Annuaire & Contenu
```
service_providers        # Fournisseurs de services (name, category, contact)
provider_categories      # Catégories de l'annuaire
content_items            # Articles blog, événements, annonces
content_translations     # Traductions FR/EN du contenu
```

### IA
```
ai_configurations        # Config des chatbots par communauté
knowledge_articles       # Articles base de connaissances
chat_sessions            # Sessions de chat IA
chat_messages            # Messages individuels
chat_usage               # Compteurs d'utilisation mensuelle
```

### Admin
```
menu_configurations      # Structure des menus dynamiques
page_meta                # SEO et meta des pages
leads                    # Prospects et leads marketing
```

---

## Variables d'environnement requises

### Base de données
```
DATABASE_URL             # URL PostgreSQL (fourni par Replit)
```

### Authentification
```
SESSION_SECRET           # Secret pour les sessions Express
GOOGLE_CLIENT_ID         # OAuth Google
GOOGLE_CLIENT_SECRET     # OAuth Google
```

### Services externes
```
STRIPE_SECRET_KEY        # Clé secrète Stripe
STRIPE_PUBLISHABLE_KEY   # Clé publique Stripe (VITE_)
STRIPE_WEBHOOK_SECRET    # Secret webhook Stripe
RESEND_API_KEY           # API Resend pour emails
OPENAI_API_KEY           # API OpenAI pour IA
GOOGLE_PLACES_API_KEY    # Google Places (import annuaire)
VITE_TINYMCE_API_KEY     # Éditeur rich text
```

### Google Drive (IA Knowledge Base)
```
GOOGLE_SERVICE_ACCOUNT_EMAIL
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY
GOOGLE_DRIVE_FOLDER_ID
```

---

## Système de plans/tiers

| Plan | Fonctionnalités |
|------|-----------------|
| `free` | Accès basique, 1 propriété, guide limité |
| `pro` | Multi-propriétés, sync iCal, AI co-hôte limité |
| `pro_plus` | Tout Pro + site réservation directe, AI illimité |
| `business` | Tout Pro+ + multi-utilisateurs, API avancée |

---

## Conventions de code

### Composants React
- Composants fonctionnels avec hooks
- shadcn/ui pour tous les composants UI
- `useQuery` / `useMutation` pour les appels API
- Fichiers dans `client/src/pages/` pour les pages

### API Routes
- Pattern RESTful (`GET /api/resource`, `POST /api/resource`)
- Middleware `isAuthenticated` pour routes protégées
- Validation avec Zod
- Erreurs retournées en JSON `{ message: string }`

### Base de données
- Drizzle ORM exclusivement
- Schéma dans `shared/schema.ts`
- Storage interface dans `server/storage.ts`

---

## Fonctionnalités clés à réutiliser

### Sync iCal bidirectionnel
- Import depuis Airbnb, VRBO, Booking.com
- Export pour sync inverse
- Détection automatique de plateforme
- `server/icalService.ts`

### Système de menus dynamique
- Menus configurables depuis l'admin
- Support multi-contexte (host, provider, admin)
- `menu_configurations` table

### Guide partageable avec QR
- URL publique `/g/:token`
- QR code généré automatiquement
- AI Concierge intégré

### Intégration Stripe complète
- Abonnements récurrents
- Webhooks synchronisés
- `stripe-replit-sync` pour sync données

---

*Document généré le 2026-01-11*
